<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#0d0d12">
    <meta name="description" content="Seguimiento de Rutina Gym">

    <title>Gym Tracker</title>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Styles -->
    <link rel="stylesheet" href="style.css?v=8.1">

    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
</head>

<body>
    <div class="container">
        <header>
            <h1>Gym Tracker <span style="font-size: 0.6em; color: var(--text-secondary);">v8.1</span></h1>
            <div id="connectionStatus" style="font-size: 0.7em; color: var(--accent-color);"></div>
        </header>

        <div class="date-selector">
            <button id="prevDay"><i class="fas fa-chevron-left"></i></button>
            <div id="currentDateDisplay">HOY</div>
            <button id="nextDay"><i class="fas fa-chevron-right"></i></button>
        </div>

        <div id="day-header" class="day-subtitle">Seleccionando rutina...</div>

        <!-- NOTA GENERAL DEL DIA -->
        <div class="day-note-container" style="margin-bottom: 20px;">
            <div class="input-group session-note-group" style="margin: 0;">
                <i class="fas fa-pen-nib" style="top: 15px; transform: none;"></i>
                <textarea id="dayGeneralNote" placeholder="Observaciones generales para el día de entrenamiento..."
                    rows="2"
                    style="width: 100%; background: rgba(0, 0, 0, 0.4); border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 8px; color: #fff; font-size: 0.85rem; padding: 10px 12px 10px 32px; resize: vertical; font-family: var(--font-main);"
                    onchange="saveDayNote(this.value)"></textarea>
            </div>
        </div>

        <div id="exercises-container">
            <!-- Los ejercicios se renderizarán aquí dinámicamente -->
        </div>

        <button id="addExerciseBtn" class="btn-primary" style="margin-top: 20px; width: 100%;">
            <i class="fas fa-plus"></i> Añadir Ejercicio
        </button>

        <button id="toggleEditModeBtn" class="btn-cancel" style="margin-top: 15px; width: 100%;">
            <i class="fas fa-unlock"></i> Configurar Rutina
        </button>

        <!-- Controles de Importación Ocultos -->
        <div id="importContainer" style="display: none; margin-top: 20px; text-align: center;">
            <label for="importFile" class="btn-cancel"
                style="cursor: pointer; display: inline-block; width: 100%; border-color: var(--accent-color); color: var(--accent-color);">
                <i class="fas fa-file-import"></i> Importar CSV de Respaldo
            </label>
            <input type="file" id="importFile" accept=".csv" style="display: none;">
        </div>
    </div>

    <!-- Modal Añadir Ejercicio -->
    <div id="addExerciseModal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <h3>Añadir Nuevo Ejercicio</h3>
            <div class="input-group-modal">
                <label>Nombre del Ejercicio *</label>
                <input type="text" id="newExName" placeholder="Ej. Sentadillas">
            </div>
            <div class="input-group-modal">
                <label>Observaciones (Opcional)</label>
                <input type="text" id="newExNotes" placeholder="Ej. 4 series de 10 reps. Bajando lento.">
            </div>
            <div class="input-group-modal">
                <label>Cantidad de Series *</label>
                <input type="number" id="newExSets" value="4" min="1">
            </div>
            <div class="input-group-modal flex-row"
                style="display: flex; align-items: center; gap: 10px; margin-top: 15px; margin-bottom: 20px;">
                <input type="checkbox" id="newExHasTime" style="width: auto; margin: 0; transform: scale(1.2);">
                <label for="newExHasTime" style="margin: 0; cursor: pointer;">Registrar Tiempo en este ejercicio</label>
            </div>
            <div class="modal-actions">
                <button id="cancelAddEx" class="btn-cancel">Cancelar</button>
                <button id="confirmAddEx" class="btn-confirm">Añadir</button>
            </div>
        </div>
    </div>

    <div class="fab-container">
        <button class="fab" id="timerFabBtn" title="Temporizador"
            style="background: var(--text-secondary); color: #000; margin-bottom: 15px;">
            <i class="fas fa-stopwatch"></i>
        </button>
        <button class="fab" id="exportBtn" title="Exportar CSV">
            <i class="fas fa-file-export"></i>
        </button>
    </div>

    <!-- Timer Panel -->
    <div id="timerPanel" class="timer-panel" style="display: none;">
        <div class="timer-header">
            <span><i class="fas fa-stopwatch"></i> Descanso</span>
            <button id="closeTimerBtn" class="timer-close"><i class="fas fa-times"></i></button>
        </div>
        <div class="timer-display" id="timerDisplay">02:00</div>
        <div class="timer-controls">
            <button id="timerSubBtn" class="timer-btn">-30s</button>
            <button id="timerToggleBtn" class="timer-btn primary"><i class="fas fa-play"></i></button>
            <button id="timerAddBtn" class="timer-btn">+30s</button>
        </div>
        <button id="timerResetBtn" class="timer-reset">Reiniciar (2:00)</button>
    </div>

    <script src="app.js?v=8.1"></script>
    <script>
        document.getElementById('connectionStatus').innerText = "Cargando JS...";
        // DESACTIVAR SERVICE WORKER (Para resolver problemas de caché)
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.getRegistrations().then(function (registrations) {
                for (let registration of registrations) {
                    console.log('Unregistering SW:', registration);
                    registration.unregister();
                }
            });
        }
    </script>
</body>

</html>